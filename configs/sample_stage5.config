# =============================================================================
# Stage 5 Sampling Configuration - Extreme Length Generation
# =============================================================================
# Stage: 1 + 2 + 3 + V2 + 4 + 5 (Full Stack)
# Max Length: L=16384-24576+
# Memory: ~30GB for L=16384
# Use Case: Extreme length proteins, large complexes, fibrous proteins
# =============================================================================

# Basic Sampling Settings
name stage5_extreme_sampling
seed 42
targetLength 16384
numSamples 5
batchSize 1

# Model Checkpoint
checkpointPath weights/stage5_model.ckpt

# Sampling Strategy
samplingStrategy ddim
numDiffusionSteps 1000
skipSteps 500                  # Aggressive skipping for extreme length

# Noise Schedule
noiseSchedule cosine
startBeta 1e-5
endBeta 0.02

# Temperature & Guidance
temperature 0.85               # Conservative for extreme length
guidanceScale 1.0

# *** STAGE 1-3 FEATURES ***
useFactorizedPairs True
zFactorRank 2
pairFactorDim 64

useFactorizedTriangleOps True
triangleUpdateRank 4

useMixedPrecision True
precision 16

# *** STAGE 3 V2: Sparse k-NN ***
useSparseKNN True
kNeighbors 32
knnStrategy hybrid
useSpatialBias True
spatialBiasRange 32            # Larger range for extreme length

# *** STAGE 4: Advanced Optimizations ***
useAxialAttention True
axialRowChunkSize 256
axialColChunkSize 256

useGradientCheckpointing True  # Even in sampling for memory
checkpointingStrategy selective

useModelCompression True
compressionStrategy universal
compressionRatio 4

# Hierarchical Sampling (for extreme length)
useHierarchicalSampling True
hierarchicalLevels 3           # 3-level hierarchy
coarseLength 2048             # Start with 2048 coarse structure
refinementStepsPerLevel 200    # Refine each level

# Output Settings
outputDir samples/stage5
savePDB True
saveTrajectory False
saveMetrics True
saveFragments True
fragmentSize 1024              # Larger fragments for extreme length

# Save intermediate levels
saveCoarseStructures True
saveRefinementSteps True

# Hardware Settings
device cuda:0

# Memory Management
clearCacheEveryNSteps 10       # Clear CUDA cache frequently
useCheckpointing True          # Enable memory checkpointing

# ===== For Multi-GPU Sampling (optional) =====
# Uncomment for parallel sampling across GPUs
# useMultiGPU True
# numGPUs 4
# samplesPerGPU 1
