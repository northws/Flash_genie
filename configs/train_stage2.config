# =============================================================================
# Stage 2 Configuration - Factorized Triangle Operations
# =============================================================================
# Stage: 1 + 2
# Max Length: L=768-1024
# Memory: ~15GB for L=1024
# Memory Saving: 256-512x (triangle ops)
# Use Case: Training with full Evoformer-style processing
# =============================================================================

# Basic Training Settings
name stage2_triangle_training
seed 42
batchSize 2
gradientAccumulation 2
maximumNumResidues 1024

# Model Architecture
singleFeatureDimension 256
pairFeatureDimension 128
structureEncoderDepth 3
structureEncoderHeads 4

# *** STAGE 1: Factorized Pairs ***
useFactorizedPairs True
zFactorRank 2
pairFactorDim 64

# *** STAGE 2 KEY FEATURES: Factorized Triangle Operations ***
useFactorizedTriangleOps True
triangleUpdateRank 4            # Low-rank for triangle multiplication
triangleAttentionChunkSize 256  # Chunked triangle attention
numTriangleLayers 4             # Number of triangle update layers

# Learning Rate & Optimization
learningRate 2e-4
warmupEpochs 100
numEpochs 500
gradientClipVal 1.0
weightDecay 0.01

# Loss Settings
lossWeights {
    "translation": 1.0,
    "rotation": 1.0,
    "backbone": 1.0,
    "chi": 0.5
}

# Diffusion Settings
diffusionTimesteps 1000
diffusionSchedule cosine
noiseSchedule exponential

# Hardware Settings
numWorkers 4
precision 32
accelerator gpu
devices 1

# Monitoring
logEveryNSteps 50
saveEveryNEpochs 10
validateEveryNEpochs 5

# Stage Features
useProgressiveTraining False
useMixedPrecision False
useChunkedLoss False
useSparseKNN False
useAxialAttention False
useModelCompression False
useDistributed False
